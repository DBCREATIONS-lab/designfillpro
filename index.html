<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Fill Pro - Professional Design Patterns</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 60px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #b8b8b8;
            margin-bottom: 30px;
        }
        
        
        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(102, 126, 234, 0.5);
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            margin-bottom: 60px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            min-height: 200px;
            position: relative;
        }
        
        .upload-section:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
        }
        
        .upload-section.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .upload-section h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        #imagePreview {
            max-width: 300px;
            max-height: 200px;
            margin: 0 auto 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }
        
        #imagePreview img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        
        #uploadInfo {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
            color: #b8b8b8;
        }
        
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            animation: progressPulse 1.5s infinite;
        }
        
        @keyframes progressPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 15px;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        #uploadActions {
            margin-top: 25px;
        }
        
        #processingText {
            margin-top: 10px;
            color: #667eea;
            font-weight: bold;
        }
        
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .pattern-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .pattern-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
        }
        
        .pattern-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .pricing-section {
            margin-top: 60px;
        }
        
        .pricing-section h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 50px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .pricing-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .pricing-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .pricing-card.featured {
            border: 2px solid #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.05);
            box-shadow: 0 16px 48px rgba(102, 126, 234, 0.2);
        }
        
        .pricing-card h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .price {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .features {
            list-style: none;
            margin: 20px 0;
        }
        
        .features li {
            padding: 8px 0;
            color: #b8b8b8;
        }
        
        .features li:before {
            content: "✓ ";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Pattern Selection Styles */
        .pattern-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .pattern-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pattern-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .pattern-option input[type="checkbox"] {
            display: none;
        }
        
        .pattern-option input[type="checkbox"]:checked + label {
            color: #667eea;
            font-weight: bold;
        }
        
        .pattern-option input[type="checkbox"]:checked {
            + label .pattern-preview {
                border-color: #667eea;
                background: linear-gradient(45deg, #667eea, #764ba2);
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            }
        }
        
        .pattern-option input[type="checkbox"]:checked + label::after {
            content: " ✓";
            color: #667eea;
            font-weight: bold;
        }
        
        .pattern-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #e0e0e0;
            font-weight: 500;
            margin: 0;
        }
        
        .pattern-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-right: 15px;
            border: 2px solid #444;
            transition: all 0.3s ease;
        }
        
        .geometric-preview {
            background: repeating-linear-gradient(
                45deg,
                #333,
                #333 5px,
                #555 5px,
                #555 10px
            );
        }
        
        .organic-preview {
            background: radial-gradient(circle at 30% 30%, #4a4a4a, #2a2a2a);
        }
        
        .floral-preview {
            background: 
                radial-gradient(circle at 20% 50%, #ff6b6b 2px, transparent 2px),
                radial-gradient(circle at 80% 50%, #4ecdc4 2px, transparent 2px),
                #333;
        }
        
        .abstract-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .tribal-preview {
            background: 
                linear-gradient(90deg, #333 50%, transparent 50%),
                linear-gradient(0deg, #555 50%, transparent 50%);
            background-size: 8px 8px;
        }
        
        .mandala-preview {
            background: 
                radial-gradient(circle at center, #667eea 1px, transparent 1px),
                radial-gradient(circle at center, transparent 8px, #333 8px, #333 10px, transparent 10px);
            background-size: 20px 20px;
        }
        
        footer {
            text-align: center;
            padding: 40px 0;
            margin-top: 60px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            color: #b8b8b8;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .upload-section { padding: 40px 20px; }
            .patterns-grid, .pricing-grid { grid-template-columns: 1fr; }
            .pricing-card.featured { transform: none; }
        }
        
        /* Animation keyframes */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate {
            animation: fadeInUp 0.6s ease forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Design Fill Pro</h1>
            <p class="subtitle">Professional design patterns to fill your creative vision</p>
        </header>

        <section class="upload-section" id="uploadSection">
            <div id="uploadDefault">
                <h3>Upload Your Design</h3>
                <p>Drag and drop your image or click to browse</p>
                <button class="btn" onclick="handleUpload()">Choose File</button>
            </div>
            <div id="uploadPreview" style="display: none;">
                <div id="imagePreview"></div>
                <div id="uploadInfo"></div>
                
                <!-- Pattern Selection -->
                <div id="patternSelection" style="display: none;">
                    <h3>Choose Fill Patterns</h3>
                    <div class="pattern-options">
                        <div class="pattern-option">
                            <input type="checkbox" id="geometric" name="patterns" value="geometric" checked>
                            <label for="geometric">
                                <span class="pattern-preview geometric-preview"></span>
                                Geometric Patterns
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="checkbox" id="organic" name="patterns" value="organic" checked>
                            <label for="organic">
                                <span class="pattern-preview organic-preview"></span>
                                Organic Shapes
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="checkbox" id="floral" name="patterns" value="floral">
                            <label for="floral">
                                <span class="pattern-preview floral-preview"></span>
                                Floral Designs
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="checkbox" id="abstract" name="patterns" value="abstract">
                            <label for="abstract">
                                <span class="pattern-preview abstract-preview"></span>
                                Abstract Art
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="checkbox" id="tribal" name="patterns" value="tribal">
                            <label for="tribal">
                                <span class="pattern-preview tribal-preview"></span>
                                Tribal Patterns
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="checkbox" id="mandala" name="patterns" value="mandala">
                            <label for="mandala">
                                <span class="pattern-preview mandala-preview"></span>
                                Mandala Designs
                            </label>
                        </div>
                    </div>
                </div>
                
                <div id="processingBar" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-bar"></div>
                    </div>
                    <p id="processingText">Processing your design...</p>
                </div>
                <div id="uploadActions">
                    <button class="btn" onclick="processImage()">Generate Patterns</button>
                    <button class="btn-secondary" onclick="resetUpload()">Upload Different</button>
                </div>
            </div>
        </section>

        <section class="patterns">
            <h2>Pattern Categories</h2>
            <div class="patterns-grid">
                <div class="pattern-card">
                    <h3>Geometric Patterns</h3>
                    <p>Modern geometric designs perfect for contemporary projects</p>
                </div>
                <div class="pattern-card">
                    <h3>Nature Patterns</h3>
                    <p>Organic designs inspired by natural forms and textures</p>
                </div>
                <div class="pattern-card">
                    <h3>Abstract Patterns</h3>
                    <p>Creative abstract designs for unique artistic expressions</p>
                </div>
                <div class="pattern-card">
                    <h3>Traditional Patterns</h3>
                    <p>Classic patterns with timeless appeal and elegance</p>
                </div>
                <div class="pattern-card">
                    <h3>Decorative Patterns</h3>
                    <p>Ornamental designs for sophisticated decorative projects</p>
                </div>
                <div class="pattern-card">
                    <h3>Texture Patterns</h3>
                    <p>Rich texture patterns that add depth and dimension</p>
                </div>
            </div>
        </section>

        <section class="pricing-section">
            <h2>Choose Your Plan</h2>
            <div class="pricing-grid">
                <div class="pricing-card">
                    <h3>Free</h3>
                    <div class="price">$0</div>
                    <ul class="features">
                        <li>5 patterns per month</li>
                        <li>Basic resolution</li>
                        <li>Community support</li>
                    </ul>
                    <button class="btn">Get Started</button>
                </div>
                <div class="pricing-card featured">
                    <h3>Pro</h3>
                    <div class="price">$19</div>
                    <ul class="features">
                        <li>100 patterns per month</li>
                        <li>High resolution</li>
                        <li>Priority support</li>
                        <li>Commercial license</li>
                    </ul>
                    <button class="btn">Start Pro</button>
                </div>
                <div class="pricing-card">
                    <h3>Enterprise</h3>
                    <div class="price">$49</div>
                    <ul class="features">
                        <li>Unlimited patterns</li>
                        <li>Ultra-high resolution</li>
                        <li>24/7 support</li>
                        <li>Extended license</li>
                        <li>Custom patterns</li>
                    </ul>
                    <button class="btn">Go Enterprise</button>
                </div>
            </div>
        </section>

        <footer>
            <p>&copy; 2024 Design Fill Pro. All rights reserved.</p>
        </footer>
    </div>

    <script>
        let uploadedFile = null;
        
        function handleUpload() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,.jpg,.jpeg,.png,.gif,.webp,.bmp,.svg';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    console.log('File selected via input:', file.name, file.type);
                    handleFile(file);
                }
            };
            input.click();
        }
        
        function handleFile(file) {
            console.log('Handling file:', file.name, file.type, file.size);
            
            // Validate file size (max 10MB)
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert('File is too large. Please upload an image smaller than 10MB.');
                return;
            }
            
            // Validate file type more thoroughly
            const validImageTypes = [
                'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 
                'image/webp', 'image/bmp', 'image/svg+xml'
            ];
            
            const isValidImage = validImageTypes.includes(file.type) || 
                               file.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/);
            
            if (!isValidImage) {
                alert('Please upload a valid image file (JPEG, PNG, GIF, WebP, BMP, or SVG)');
                return;
            }
            
            uploadedFile = file;
            
            // Show file info
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            const fileInfo = `
                <strong>File:</strong> ${file.name}<br>
                <strong>Size:</strong> ${fileSize} MB<br>
                <strong>Type:</strong> ${file.type || 'Image file'}
            `;
            document.getElementById('uploadInfo').innerHTML = fileInfo;
            
            // Show image preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Uploaded image preview';
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = '';
                preview.appendChild(img);
                
                // Switch to preview mode and show pattern selection
                document.getElementById('uploadDefault').style.display = 'none';
                document.getElementById('uploadPreview').style.display = 'block';
                document.getElementById('patternSelection').style.display = 'block';
                document.getElementById('uploadSection').style.cursor = 'default';
            };
            
            reader.onerror = function() {
                alert('Error reading file. Please try again.');
            };
            
            reader.readAsDataURL(file);
        }
        
        function processImage() {
            if (!uploadedFile) return;
            
            // Hide actions and show processing
            document.getElementById('uploadActions').style.display = 'none';
            document.getElementById('processingBar').style.display = 'block';
            
            // Analyze the uploaded image for inner shapes and transparency
            analyzeImageStructure().then(() => {
                // Simulate processing with progress bar
                let progress = 0;
                const progressBar = document.querySelector('.progress-bar');
                const processingText = document.getElementById('processingText');
                
                const messages = [
                    'Analyzing image structure and inner shapes...',
                    'Detecting transparent areas and negative space...',
                    'Mapping fill regions while preserving inner shapes...',
                    'Generating patterns that respect original design...',
                    'Creating variations with proper masking...',
                    'Finalizing your shape-aware patterns...'
                ];
            
                const interval = setInterval(() => {
                    progress += Math.random() * 15 + 10;
                    if (progress > 100) progress = 100;
                    
                    progressBar.style.width = progress + '%';
                    processingText.textContent = messages[Math.floor((progress / 100) * messages.length)];
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            showResults();
                        }, 500);
                    }
                }, 800);
            });
        }
        
        function analyzeImageStructure() {
            return new Promise((resolve) => {
                const img = document.querySelector('#imagePreview img');
                if (!img) {
                    resolve();
                    return;
                }
                
                // Create canvas for image analysis
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = Math.min(img.naturalWidth, 800);
                canvas.height = Math.min(img.naturalHeight, 800);
                
                // Draw image to canvas for pixel analysis
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                try {
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const pixels = imageData.data;
                    
                    // Analyze image structure
                    let transparentPixels = 0;
                    let totalPixels = pixels.length / 4;
                    let hasInnerShapes = false;
                    let edgePixels = 0;
                    
                    // Check for transparency and edge detection
                    for (let i = 0; i < pixels.length; i += 4) {
                        const alpha = pixels[i + 3];
                        if (alpha < 128) {
                            transparentPixels++;
                        }
                        
                        // Simple edge detection for inner shapes
                        const x = (i / 4) % canvas.width;
                        const y = Math.floor(i / 4 / canvas.width);
                        
                        if (x > 0 && x < canvas.width - 1 && y > 0 && y < canvas.height - 1) {
                            const currentAlpha = pixels[i + 3];
                            const rightAlpha = pixels[i + 7];
                            const bottomAlpha = pixels[i + (canvas.width * 4) + 3];
                            
                            if (Math.abs(currentAlpha - rightAlpha) > 100 || 
                                Math.abs(currentAlpha - bottomAlpha) > 100) {
                                edgePixels++;
                            }
                        }
                    }
                    
                    // Store analysis results globally for use in pattern generation
                    window.imageAnalysis = {
                        hasTransparency: transparentPixels > totalPixels * 0.1,
                        transparentRatio: transparentPixels / totalPixels,
                        hasInnerShapes: edgePixels > totalPixels * 0.05,
                        complexity: edgePixels / totalPixels,
                        dimensions: { width: canvas.width, height: canvas.height }
                    };
                    
                    console.log('Image Analysis:', window.imageAnalysis);
                    
                } catch (error) {
                    console.log('Canvas analysis failed (likely CORS), using basic analysis');
                    // Fallback analysis based on file type and name
                    window.imageAnalysis = {
                        hasTransparency: uploadedFile.type === 'image/png' || uploadedFile.name.toLowerCase().includes('transparent'),
                        transparentRatio: 0.2,
                        hasInnerShapes: true,
                        complexity: 0.3,
                        dimensions: { width: 400, height: 400 }
                    };
                }
                
                setTimeout(resolve, 1000); // Give time for analysis visualization
            });
        }
        
        function showResults() {
            // Get selected patterns
            const selectedPatterns = [];
            const checkboxes = document.querySelectorAll('input[name="patterns"]:checked');
            checkboxes.forEach(checkbox => {
                selectedPatterns.push({
                    value: checkbox.value,
                    label: checkbox.nextElementSibling.textContent.trim()
                });
            });
            
            if (selectedPatterns.length === 0) {
                alert('Please select at least one pattern type to generate!');
                return;
            }
            
            const patternCount = selectedPatterns.length * 4; // 4 variations per pattern type
            
            // Get image analysis results
            const analysis = window.imageAnalysis || {
                hasTransparency: false,
                transparentRatio: 0,
                hasInnerShapes: false,
                complexity: 0.1
            };
            
            // Create analysis summary
            let analysisInfo = '';
            analysisInfo += `✓ Original image used as pattern mask<br>`;
            if (analysis.hasTransparency) {
                analysisInfo += `✓ Transparent areas preserved (${(analysis.transparentRatio * 100).toFixed(1)}%)<br>`;
            }
            if (analysis.hasInnerShapes) {
                analysisInfo += `✓ Inner geometry and negative space respected<br>`;
            }
            analysisInfo += `✓ Image complexity: ${analysis.complexity > 0.3 ? 'High' : analysis.complexity > 0.1 ? 'Medium' : 'Low'}<br>`;
            analysisInfo += `✓ Patterns generated with multiply blend mode for shape preservation`;
            
            // Generate pattern previews based on selection and analysis
            let patternPreviews = '';
            
            // Get the uploaded image for masking
            const uploadedImg = document.querySelector('#imagePreview img');
            const imageDataURL = uploadedImg ? uploadedImg.src : '';
            
            selectedPatterns.forEach(pattern => {
                switch(pattern.value) {
                    case 'geometric':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'repeating-linear-gradient(45deg, #667eea, #667eea 8px, transparent 8px, transparent 12px)'}, 
                                    repeating-linear-gradient(45deg, #667eea, #667eea 8px, transparent 8px, transparent 12px), 
                                    repeating-linear-gradient(-45deg, #764ba2, #764ba2 8px, transparent 8px, transparent 12px);
                                background-size: contain, 20px 20px, 20px 20px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Shape-aware Geometric Pattern"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'radial-gradient(circle at 25% 25%, #667eea 3px, transparent 5px)'}, 
                                    radial-gradient(circle at 25% 25%, #667eea 3px, transparent 8px), 
                                    radial-gradient(circle at 75% 75%, #764ba2 3px, transparent 8px), 
                                    #1a1a2e;
                                background-size: contain, 15px 15px, 15px 15px, auto;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0, 0 0;
                            " title="Dotted Geometric with Shape Mask"></div>
                        `;
                        break;
                    case 'organic':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'radial-gradient(ellipse at 30% 30%, #667eea 20%, transparent 40%)'}, 
                                    radial-gradient(ellipse at 30% 30%, #667eea 15%, transparent 30%), 
                                    radial-gradient(ellipse at 70% 70%, #764ba2 12%, transparent 25%), 
                                    #1a1a2e;
                                background-size: contain, 40px 30px, 40px 30px, auto;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0, 0 0;
                            " title="Organic with Shape Preservation"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'radial-gradient(circle at 20% 50%, #667eea 15px, transparent 20px)'}, 
                                    radial-gradient(circle at 20% 50%, #667eea 8px, transparent 15px), 
                                    radial-gradient(circle at 80% 50%, #764ba2 6px, transparent 12px), 
                                    #1a1a2e;
                                background-size: contain, 50px 35px, 50px 35px, auto;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0, 0 0;
                            " title="Organic Bubble with Mask"></div>
                        `;
                        break;
                    case 'floral':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'radial-gradient(circle at 25% 25%, #ff6b6b 2px, transparent 8px)'}, 
                                    radial-gradient(circle at 25% 25%, #ff6b6b 2px, transparent 6px), 
                                    radial-gradient(circle at 75% 75%, #4ecdc4 2px, transparent 6px), 
                                    radial-gradient(circle at 50% 50%, transparent 12px, #667eea 12px, #667eea 13px, transparent 13px);
                                background-size: contain, 25px 25px, 25px 25px, 25px 25px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0, 0 0;
                            " title="Floral with Shape Cutouts"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'conic-gradient(from 0deg at 50% 50%, #ff6b6b 60deg, transparent 60deg 120deg, #4ecdc4 120deg 180deg, transparent 180deg)'}, 
                                    conic-gradient(from 0deg at 50% 50%, #ff6b6b 45deg, transparent 45deg 90deg, #4ecdc4 90deg 135deg, transparent 135deg), 
                                    radial-gradient(circle at center, transparent 6px, rgba(102, 126, 234, 0.2) 8px);
                                background-size: contain, 30px 30px, 30px 30px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Petal Pattern with Image Mask"></div>
                        `;
                        break;
                    case 'abstract':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)'}, 
                                    linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                                background-size: contain, auto;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat;
                                background-position: center, 0 0;
                            " title="Abstract with Shape"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'conic-gradient(from 180deg, #667eea, #764ba2, #f093fb, #667eea)'}, 
                                    conic-gradient(from 180deg, #667eea, #764ba2, #f093fb, #667eea);
                                background-size: contain, auto;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat;
                                background-position: center, 0 0;
                            " title="Conic Abstract with Mask"></div>
                        `;
                        break;
                    case 'tribal':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'repeating-linear-gradient(90deg, #667eea 0px, #667eea 6px, transparent 6px, transparent 10px)'}, 
                                    repeating-linear-gradient(90deg, #667eea 0px, #667eea 6px, transparent 6px, transparent 10px), 
                                    repeating-linear-gradient(0deg, #764ba2 0px, #764ba2 6px, transparent 6px, transparent 10px);
                                background-size: contain, 20px 20px, 20px 20px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Tribal Grid with Shape Cutout"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'linear-gradient(45deg, #667eea 20%, transparent 20% 40%, #764ba2 40% 60%, transparent 60%)'}, 
                                    linear-gradient(45deg, #667eea 15%, transparent 15% 35%, #764ba2 35% 55%, transparent 55%), 
                                    linear-gradient(-45deg, #764ba2 15%, transparent 15% 35%, #667eea 35% 55%, transparent 55%);
                                background-size: contain, 18px 18px, 18px 18px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Tribal Diamond with Image Mask"></div>
                        `;
                        break;
                    case 'mandala':
                        patternPreviews += `
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'radial-gradient(circle at center, transparent 4px, #667eea 4px 6px, transparent 6px 10px, #764ba2 10px 12px, transparent 12px)'}, 
                                    radial-gradient(circle at center, transparent 4px, #667eea 4px 6px, transparent 6px 10px, #764ba2 10px 12px, transparent 12px), 
                                    conic-gradient(from 0deg, rgba(102, 126, 234, 0.3) 45deg, transparent 45deg 90deg, rgba(118, 75, 162, 0.3) 90deg 135deg, transparent 135deg);
                                background-size: contain, 35px 35px, 35px 35px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Mandala with Shape Void"></div>
                            <div style="
                                background: 
                                    ${imageDataURL ? `url('${imageDataURL}')` : 'conic-gradient(from 0deg, #667eea 25deg, transparent 25deg 50deg, #764ba2 50deg 75deg, transparent 75deg)'}, 
                                    conic-gradient(from 0deg, #667eea 20deg, transparent 20deg 40deg, #764ba2 40deg 60deg, transparent 60deg), 
                                    radial-gradient(circle at center, transparent 8px, rgba(255,255,255,0.1) 10px);
                                background-size: contain, 40px 40px, 40px 40px;
                                background-blend-mode: ${imageDataURL ? 'multiply' : 'normal'};
                                height: 60px; border-radius: 8px; background-repeat: no-repeat, repeat, repeat;
                                background-position: center, 0 0, 0 0;
                            " title="Segmented Mandala with Mask"></div>
                        `;
                        break;
                }
            });
            
            const resultHTML = `
                <div style="text-align: center;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">✨ Pattern Generation Complete!</h3>
                    <div style="background: rgba(102, 126, 234, 0.1); border-radius: 15px; padding: 30px; margin: 20px 0;">
                        <p style="font-size: 1.1rem; margin-bottom: 15px;">Successfully generated <strong>${patternCount} unique patterns</strong> from your design!</p>
                        <p style="color: #b8b8b8; margin-bottom: 15px;">Pattern types: ${selectedPatterns.map(p => p.label).join(', ')}</p>
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; margin: 15px 0; text-align: left;">
                            <h4 style="color: #667eea; margin: 0 0 10px 0; font-size: 0.9rem;">🔍 Image Analysis Results:</h4>
                            <p style="color: #e0e0e0; font-size: 0.85rem; margin: 0; line-height: 1.4;">${analysisInfo}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin: 20px 0;">
                            ${patternPreviews}
                        </div>
                        <div style="margin-top: 25px;">
                            <button class="btn" onclick="downloadPatterns()">Download All Patterns</button>
                            <button class="btn-secondary" onclick="resetUpload()">Upload New Design</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('uploadPreview').innerHTML = resultHTML;
        }
        
        function downloadPatterns() {
            alert('🎉 Download started! Your 24 unique patterns are being prepared...\n\nIn a real app, this would download a ZIP file with all generated patterns.');
        }
        
        function resetUpload() {
            uploadedFile = null;
            document.getElementById('uploadDefault').style.display = 'block';
            document.getElementById('uploadPreview').style.display = 'none';
            document.getElementById('patternSelection').style.display = 'none';
            document.getElementById('uploadSection').style.cursor = 'pointer';
            
            // Reset pattern selections to default
            document.getElementById('geometric').checked = true;
            document.getElementById('organic').checked = true;
            document.getElementById('floral').checked = false;
            document.getElementById('abstract').checked = false;
            document.getElementById('tribal').checked = false;
            document.getElementById('mandala').checked = false;
        }
        
        // Enhanced drag and drop functionality
        function initializeDragDrop() {
            const uploadSection = document.getElementById('uploadSection');
            
            // Prevent default drag behaviors on the entire document
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.addEventListener(eventName, preventDefaults, false);
                uploadSection.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Highlight upload area when dragging files over it
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadSection.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadSection.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight(e) {
                uploadSection.classList.add('dragover');
            }
            
            function unhighlight(e) {
                uploadSection.classList.remove('dragover');
            }
            
            // Handle the dropped files
            uploadSection.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                console.log('Files dropped:', files.length);
                
                if (files.length > 0) {
                    const file = files[0];
                    console.log('File type:', file.type);
                    console.log('File name:', file.name);
                    
                    // Check if it's an image file (including JPEG variations)
                    const validImageTypes = [
                        'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 
                        'image/webp', 'image/bmp', 'image/svg+xml'
                    ];
                    
                    const isValidImage = validImageTypes.includes(file.type) || 
                                       file.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/);
                    
                    if (isValidImage) {
                        handleFile(file);
                    } else {
                        alert('Please upload a valid image file (JPEG, PNG, GIF, WebP, BMP, or SVG)');
                    }
                }
            }
        }
        
        // Initialize drag and drop when page loads
        document.addEventListener('DOMContentLoaded', initializeDragDrop);
        
        // Initialize pattern selection
        document.addEventListener('DOMContentLoaded', function() {
            // Make pattern options more interactive
            const patternOptions = document.querySelectorAll('.pattern-option');
            patternOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    // Visual feedback
                    if (checkbox.checked) {
                        this.style.borderColor = '#667eea';
                        this.style.background = 'rgba(102, 126, 234, 0.15)';
                    } else {
                        this.style.borderColor = 'transparent';
                        this.style.background = 'rgba(255, 255, 255, 0.05)';
                    }
                });
            });
        });
        
        // Add animation effects
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.pattern-card, .pricing-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                setTimeout(() => {
                    card.classList.add('animate');
                }, index * 100);
            });
        });
    </script>
</body>
</html>